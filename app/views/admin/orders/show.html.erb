<h1 class="mb-3">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è ‚Ññ<%= @order.id %></h1>

<div class="card shadow p-3 mb-4">
  <p><strong>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á:</strong>
    <% if @order.user.present? %>
      <%= @order.user.email %>
    <% else %>
      <span class="text-muted">[–í—ñ–¥—Å—É—Ç–Ω—ñ–π]</span>
    <% end %>
  </p>
  <p><strong>–°—Ç–∞—Ç—É—Å:</strong>
    <span class="badge 
      <%= case @order.status&.downcase
          when 'new' then 'bg-primary'
          when 'processing' then 'bg-warning text-dark'
          when 'completed' then 'bg-success'
          when 'canceled' then 'bg-danger'
          else 'bg-secondary' end %>">
      <%= @order.status&.capitalize || '–ù–µ–≤–∏–∑–Ω–∞—á–µ–Ω–æ' %>
    </span>
  </p>
  <p><strong>–°—É–º–∞:</strong> 
    <% final_sum = @order.total_price.to_f > 0 ? @order.total_price : @order.calculate_total %>
      <%= number_to_currency(final_sum, unit: "‚Ç¥") %>
  </p>
  <p><strong>–°—Ç–≤–æ—Ä–µ–Ω–æ:</strong> <%= @order.created_at.strftime("%d.%m.%Y %H:%M") %></p>
</div>

<h3 class="mb-3">üìö –¢–æ–≤–∞—Ä–∏ —É –∑–∞–º–æ–≤–ª–µ–Ω–Ω—ñ</h3>
<table class="table table-bordered shadow-sm">
  <thead class="table-light">
    <tr>
      <th>–ö–Ω–∏–≥–∞</th>
      <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å</th>
      <th>–¶—ñ–Ω–∞ –∑–∞ –æ–¥–∏–Ω–∏—Ü—é</th>
      <th>–°—É–º–∞</th>
    </tr>
  </thead>
  <tbody>
    <% @order.order_items.each do |item| %>
      <tr>
        <td>
          <% if item.book.present? %>
            <%= item.book.title %>
          <% else %>
            <span class="text-muted">[–ö–Ω–∏–≥–∞ –≤–∏–¥–∞–ª–µ–Ω–∞]</span>
          <% end %>
        </td>
        <td><%= item.quantity %> —à—Ç</td>
        <td><%= number_to_currency(item.unit_price, unit: "‚Ç¥") %></td>
        <td class="fw-bold"><%= number_to_currency(item.unit_price * item.quantity, unit: "‚Ç¥") %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<div class="card p-3 shadow mt-4">
  <%= form_with(model: [:admin, @order], class: "row g-3") do |f| %>
    <div class="col-md-6">
      <%= f.label :status, "–ó–º—ñ–Ω–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å", class: "form-label fw-bold" %>
      <%= f.select :status, ["new", "processing", "completed", "canceled"], selected: @order.status, class: "form-select" %>
    </div>
    <div class="col-md-6 d-flex align-items-end">
      <%= f.submit "–û–Ω–æ–≤–∏—Ç–∏", class: "btn btn-success w-100" %>
    </div>
  <% end %>
</div>

<div class="mt-4">
  <%= link_to "‚¨Ö –ù–∞–∑–∞–¥ –¥–æ –∑–∞–º–æ–≤–ª–µ–Ω—å", admin_orders_path, class: "btn btn-outline-secondary" %>
</div>
